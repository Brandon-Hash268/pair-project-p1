<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Home</title>
    <%- include('partials/logo') %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <style>
        body {
            background-color: #f0f4f8; /* Light grey background for better contrast */
            font-family: "Open Sans", sans-serif; /* Consistent font */
        }
        .headerName {
            color: rgba(0, 35, 122, 0.9);
            font-size: 40px; /* Increased font size for header */
            text-align: center; /* Centering the header */
            margin: 20px 0; /* Spacing above and below the header */
            text-transform: uppercase;
        }
        .table th {
            background-color: rgba(0, 35, 122, 0.8); /* Darker header color */
            color: white; /* White text for header */
        }
        .table tbody tr {
            transition: background-color 0.3s; /* Smooth transition for hover effect */
        }
        .table tbody tr:hover {
            background-color: rgba(0, 35, 122, 0.1); /* Light background on hover */
        }
        .btn-custom {
            transition: background-color 0.3s, color 0.3s; /* Smooth transition for button hover */
        }
        .btn-custom:hover {
            background-color: rgba(0, 35, 122, 0.9);
            color: white; /* Change text color on hover */
        }
        .card {
            background-color: white; /* White background for card */
            border-radius: 15px; /* Rounded corners */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
            margin-bottom: 20px; /* Space below each card */
            padding: 20px; /* Padding inside the card */
        }
    </style>
</head>
<body>
  <%- include('partials/navbar') %>
  
  <h1 class="headerName">Stocks</h1>
  
  <% if (error) { %>
    <div id="errorAlert" class="alert alert-danger alert-dismissible fade show" role="alert">
      <strong>Error!</strong> <%= error %> <!-- Display the error message -->
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% } %>
  
  <div class="container mt-4">
    <div class="card">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <% if (role == "Admin") { %>
            <a href="/stock/add"><button style="margin-bottom: 10px;" class="btn btn-primary">Add Stock</button></a>
          <% } %>
        </div>
        <div>
          <form class="d-flex">
              <input type="text" name="search" class="form-control me-2" placeholder="Search Stock by Code" aria-label="Search">
              <button class="btn btn-outline-primary me-2" type="submit">Search</button>
              <a name="search" class="btn btn-outline-primary me-2">All</a> <!-- Added All button -->
          </form>
      </div>
      </div>
      
      <table class="table align-middle mb-0">
          <thead class="bg-light">
              <tr>
                  <th>Company Name</th>
                  <th>Code</th>
                  <th>Price</th>
                  <th>Actions</th>
              </tr>
          </thead>
          <tbody>
              <% data.forEach(e => { %>
                  <tr>
                      <td>
                          <div class="d-flex align-items-center">
                              <img src="<%= e.imgUrl %>" alt="" style="width: 45px; height: 45px" class="rounded-circle" />
                              <div class="ms-3">
                                  <p class="fw-bold mb-1"><%= e.companyName %></p>
                              </div>
                          </div>
                      </td>
                      <td>
                          <p class="fw-normal mb-1"><%= e.code %></p>
                      </td>
                      <td>
                          <p class="fw-normal mb-1"><%= currency(e.price) %></p>
                      </td>
                      <td>
                        <% if (role == "Investor") { %>
                          <a href="/stock/<%= e.id %>/buy"><button type="button" class="btn btn-sm btn-success btn-custom">Buy</button></a>
                          <a href="/stock/<%= e.id %>/sell"><button type="button" class="btn btn-sm btn-danger btn-custom">Sell</button></a>
                        <% } else { %>
                          <a href="/stock/<%= e.id %>/edit"><button type="button" class="btn btn-sm btn-primary btn-custom">Edit</button></a>
                          <a href="/stock/<%= e.id %>/delete"><button type="button" class="btn btn-sm btn-danger btn-custom">Delete</button></a>
                        <% } %>
                      </td>
                  </tr>
              <% }) %>
          </tbody>
      </table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  
  <script>
    // Automatically dismiss the alert after 5 seconds
    setTimeout(() => {
      const alert = document.getElementById('errorAlert');
      if (alert) {
        alert.classList.remove('show');
        alert.classList.add('fade');
        setTimeout(() => {
          alert.remove();
        }, 500); // Remove from DOM after fade transition
      }
    }, 2000); // 5 seconds
  </script>
</body>
</html>
